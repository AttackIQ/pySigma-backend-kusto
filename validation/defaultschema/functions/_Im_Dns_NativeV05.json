{"_Im_Dns_NativeV05": {"body": "let parser=\r\n(\r\n  starttime:datetime=datetime(null), \r\n  endtime:datetime=datetime(null),\r\n  srcipaddr:string='*',\r\n  domain_has_any:dynamic=dynamic([]),\r\n  responsecodename:string='*', \r\n  response_has_ipv4:string='*',\r\n  response_has_any_prefix:dynamic=dynamic([]),\r\n  eventtype:string='Query',\r\n  disabled:bool=false\r\n)\r\n{\r\n  ASimDnsActivityLogs  | where not(disabled)\r\n  //  -- Pre-parsing filtering:\r\n  | where\r\n      (response_has_ipv4=='*') and (array_length(response_has_any_prefix) == 0) // -- Check that unsupported filters are set to default\r\n      and (isnull(starttime) or TimeGenerated >= starttime)\r\n      and (isnull(endtime) or TimeGenerated <= endtime)\r\n      and (srcipaddr=='*' or SrcIpAddr==srcipaddr)\r\n      and (array_length(domain_has_any) ==0 or DnsQuery has_any (domain_has_any))\r\n      and (responsecodename=='*' or EventResultDetails == responsecodename)\r\n      and (eventtype == \"*\" or eventtype == EventType or (eventtype == \"lookup\" and EventType == \"Query\")) // -- Support \"lookup\" as value for backward compatibility\r\n  // --\r\n  | project-rename\r\n      EventUid = _ItemId,\r\n      DvcScopeId = _SubscriptionId\r\n  | extend\r\n      EventStartTime = TimeGenerated,\r\n      EventEndTime = TimeGenerated,\r\n      Dvc = iff (isempty(Dvc), coalesce (DvcFQDN, DvcHostname, SrcIpAddr, DvcId, _ResourceId), Dvc),\r\n      Dst = coalesce (DstFQDN, DstHostname, DstIpAddr, DstDvcId),\r\n      Src = coalesce (SrcFQDN, SrcHostname, SrcIpAddr, SrcDvcId),\r\n      EventSchema = \"Dns\"\r\n  // -- Type fixes\r\n  | extend\r\n      ThreatConfidence = toint(ThreatConfidence),\r\n      ThreatFirstReportedTime = todatetime(ThreatFirstReportedTime),\r\n      ThreatIsActive = tobool(ThreatIsActive),\r\n      ThreatLastReportedTime = todatetime(ThreatLastReportedTime),\r\n      ThreatOriginalRiskLevel = tostring(ThreatOriginalRiskLevel),\r\n      ThreatRiskLevel = toint(ThreatRiskLevel)\r\n  //  -- Aliases here\r\n  | extend\r\n      DnsResponseCodeName=EventResultDetails,\r\n      Domain=DnsQuery,\r\n      IpAddr=SrcIpAddr,\r\n      SessionId=DnsSessionId,\r\n      Duration = DnsNetworkDuration,\r\n      Process = SrcProcessName,\r\n      User = SrcUsername,\r\n      Hostname = SrcHostname\r\n    | project-away\r\n        TenantId, SourceSystem, _ResourceId\r\n};\r\nparser (starttime=starttime, endtime=endtime, srcipaddr=srcipaddr, domain_has_any=domain_has_any, responsecodename=responsecodename, response_has_ipv4=response_has_ipv4, response_has_any_prefix=response_has_any_prefix, eventtype=eventtype, disabled=disabled)\r\n", "params": "starttime:datetime = datetime(null), endtime:datetime = datetime(null), srcipaddr:string = '*', domain_has_any:dynamic = dynamic([]), responsecodename:string = '*', response_has_ipv4:string = '*', response_has_any_prefix:dynamic = dynamic([]), eventtype:string = 'Query', disabled:bool = false"}}