{"_ASim_NetworkSession_MD4IoTSensorV01": {"body": "let parser = (disabled:bool=false) \r\n{\r\n  DefenderIoTRawEvent\r\n  | where RawEventName == \"NetworkConnectionData\"\r\n  | project-rename \r\n      DvcSubscriptionId = AzureSubscriptionId\r\n  | extend \r\n      Dvc = tostring(EventDetails.SourceId),\r\n      DstDvcId = tostring(EventDetails.Destination.DeviceId),\r\n      DstMacAddr = tostring(EventDetails.Destination.MacAddress),\r\n      DstIpAddr = tostring(EventDetails.Destination.IPAddress),\r\n      DstPortNumber = toint(EventDetails.Destination.Port),\r\n      DstDescription = tostring(EventDetails.Destination.DeviceName),\r\n      SrcDvcId = tostring(EventDetails.Source.DeviceId),\r\n      SrcMacAddr = tostring(EventDetails.Source.MacAddress),\r\n      SrcIpAddr = tostring(EventDetails.Source.IPAddress),\r\n      SrcPortNumber = toint(EventDetails.Source.Port),\r\n      SrcDescription = tostring(EventDetails.Source.DeviceName),\r\n      EventOriginalUid = tostring(EventDetails.Id),\r\n      EventEndTime = todatetime(EventDetails.LastSeen),\r\n      EventStartTime = todatetime(EventDetails.StartTime),\r\n      NetworkProtocol = tostring(EventDetails.TransportProtocol)\r\n  | extend\r\n      EventProduct = 'Defender for IoT',\r\n      EventResult = 'Success',\r\n      EventSchema = 'NetworkSession',\r\n      EventSchemaVersion='0.2.4',\r\n      EventCount = toint(1),\r\n      EventSeverity = 'Informational',\r\n      EventType = iff(DstIpAddr=='' and SrcIpAddr == '','L2NetworkSession','NetworkSession'),\r\n      NetworkDirection = iff(tobool(EventDetails.IsInternal), 'Local',''),\r\n      EventVendor = 'Microsoft',\r\n      DstDvcIdType = 'MD4IoTid',\r\n      SrcDvcIdType = 'MD4IoTid'\r\n  | extend // -- Aliases\r\n      Dst = coalesce(DstIpAddr,DstMacAddr),\r\n      Src = coalesce(SrcIpAddr,SrcMacAddr),\r\n      IpAddr = SrcIpAddr,\r\n      EventStartTime = EventEndTime\r\n  | project-away \r\n      RawEventCategory, RawEventName, RawEventType, SourceSystem, TenantId, AgentVersion, IoTRawEventId, IsEmpty, AgentId, DeviceId, TimeStamp\r\n  | project-away EventDetails, AssociatedResourceId\r\n};\r\nparser (disabled)", "params": "disabled:bool = false"}}