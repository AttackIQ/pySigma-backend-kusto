{"_ASim_NetworkSession_PaloAltoCEFV04": {"body": "let Actions=datatable(DeviceAction:string,DvcAction:string)\r\n[ \"reset client\",\"Reset Source\"\r\n, \"reset server\",\"Reset Destination\"\r\n, \"reset both\", \"Reset\"\r\n, \"allow\",\"Allow\"\r\n, \"deny\",\"Deny\"\r\n, \"drop\", \"Drop\"\r\n, \"drop ICMP\", \"Drop ICMP\"];\r\nlet NWParser=(disabled:bool=false){\r\nCommonSecurityLog | where not(disabled)\r\n| where DeviceVendor==\"Palo Alto Networks\" and (Activity==\"TRAFFIC\")\r\n| parse AdditionalExtensions with \"PanOSPacketsReceived=\" DstPackets:long \",PanOSPacketsSent=\" SrcPackets:long \",start=\"EventStartTime \",reason=\"*\r\n| project-rename \r\n    EventProductVersion=DeviceVersion // Not Documented\r\n  , Dvc=DeviceName   \r\n  , NetworkApplicationProtocol=ApplicationProtocol\r\n  , SrcZone=DeviceCustomString4 \r\n  , DstZone=DeviceCustomString5\r\n  , NetworkRuleName=DeviceCustomString1\r\n  , SrcUsername=SourceUserName \r\n  , DstUsername=DestinationUserName \r\n  , EventOriginalSeverity=LogSeverity // not documented\r\n  , SrcNatIpAddr=SourceTranslatedAddress\r\n  , DstNatIpAddr=DestinationTranslatedAddress\r\n  , PaloAltoFlags=FlexString1 // Flags\r\n| extend\r\nEventVendor=\"Palo Alto\"\r\n  ,EventProduct=\"PanOS\" // Not Documented\r\n  , SrcBytes=tolong(SentBytes)\r\n  , DstBytes=tolong(ReceivedBytes) \r\n  , NetworkPackets=tolong(DeviceCustomNumber2) \r\n  , NetworkProtocol=toupper(Protocol)\r\n  , NetworkBytes=tolong(FlexNumber1)\r\n  , SrcUsernameType=case(isempty(SrcUsername), \"\", SrcUsername contains \"@\", \"UPN\", \"Simple\")\r\n  , DstUsernameType=case(isempty(DstUsername), \"\", DstUsername contains \"@\", \"UPN\", \"Simple\")\r\n  , EventType=\"NetworkSession\"\r\n  , EventCount=toint(1)\r\n  , EventResult=case(DeviceAction==\"allow\",\"Success\",\"Failure\")\r\n  , NetworkSessionId=tostring(DeviceCustomNumber1)\r\n  , NetworkDuration=toint(1000*DeviceCustomNumber3)\r\n  , EventSchemaVersion=\"0.2.1\"\r\n  , EventSchema=\"NetworkSession\"\r\n  , EventSeverity = \"Informational\"\r\n  , EventStartTime=coalesce(todatetime(EventStartTime), TimeGenerated)\r\n| extend hostelements=split(Dvc,'.')\r\n| extend DvcHostname=tostring(hostelements[0])\r\n       , DvcDomain=strcat_array( array_slice(hostelements,1,-1), '.')\r\n| extend DvcFQDN = iff(Dvc contains \".\",Dvc,\"\" )\r\n      , DvcDomainType=iff(Dvc contains \".\",\"FQDN\",\"\" )\r\n| project-away hostelements\r\n| lookup Actions on DeviceAction\r\n| project-rename\r\n  DstMacAddr=DestinationMACAddress\r\n  , SrcMacAddr=SourceMACAddress\r\n  , DstIpAddr=DestinationIP\r\n  , DstPortNumber=DestinationPort\r\n  , DstNatPortNumber=DestinationTranslatedPort\r\n  , SrcPortNumber=SourcePort\r\n  , SrcIpAddr=SourceIP\r\n  , SrcNatPortNumber=SourceTranslatedPort\r\n  , DvcOutboundInterface=DeviceOutboundInterface\r\n  , DvcInboundInterface=DeviceInboundInterface\r\n  , EventMessage=Message\r\n  , DvcOriginalAction=DeviceAction\r\n// -- Aliases\r\n| extend\r\nIpAddr = SrcIpAddr,\r\nRule=NetworkRuleName,\r\nDst=DstIpAddr,\r\n// Host=DstHostname, \r\nUser=DstUsername,\r\nDuration=NetworkDuration,\r\nSessionId=NetworkSessionId,\r\nEventEndTime =EventStartTime,\r\nSrc=SrcIpAddr\r\n};\r\nNWParser(disabled)", "params": "disabled:bool = false"}}